<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>قرآن مبارک</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Styles remain unchanged */
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // State Management (React-like)
        const state = {
            darkMode: false,
            fontSize: 120,
            language: 'urdu',
            currentPage: 1,
            versesPerPage: 10,
            currentChapter: '',
            bookmarks: [],
            quranData: [],
            themesData: [],
            currentThemePage: 1,
            themesPerPage: 5,
        };

        // DOM Elements
        const app = document.getElementById('app');

        // Utility Functions
        const render = () => {
            ReactDOM.render(<App />, app);
        };

        const updateFontSize = (size) => {
            state.fontSize = size;
            localStorage.setItem('quran-font-size', size);
            render();
        };

        const toggleDarkMode = () => {
            state.darkMode = !state.darkMode;
            localStorage.setItem('quran-dark-mode', state.darkMode);
            render();
        };

        const setLanguage = (lang) => {
            state.language = lang;
            localStorage.setItem('quran-language', lang);
            render();
        };

        const showError = (message) => {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => errorDiv.style.display = 'none', 5000);
        };

        const setupEventListeners = () => {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    state.currentPage = 1;
                    state.currentChapter = '';
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
                    if (tab.dataset.tab === 'quran') displayQuran();
                    else if (tab.dataset.tab === 'themes') displayThemes();
                    else if (tab.dataset.tab === 'bookmarks') displayBookmarks();
                });
            });

            document.getElementById('settings-toggle').addEventListener('click', () => {
                document.getElementById('settings-panel').classList.toggle('open');
            });

            document.getElementById('increase-font').addEventListener('click', () => {
                updateFontSize(Math.min(state.fontSize + 10, 200));
            });

            document.getElementById('decrease-font').addEventListener('click', () => {
                updateFontSize(Math.max(state.fontSize - 10, 80));
            });

            document.getElementById('mode-toggle').addEventListener('click', toggleDarkMode);

            document.getElementById('language-toggle').addEventListener('change', (e) => {
                setLanguage(e.target.value);
            });

            document.getElementById('goto-button').addEventListener('click', () => {
                const input = document.getElementById('goto-input').value.trim();
                const [chapter, verse] = input.split(':').map(Number);
                if (chapter && verse) goToVerse(chapter, verse);
                else showError('براہ کرم درست سورۃ اور آیت نمبر درج کریں۔');
            });

            document.getElementById('prev-theme-page').addEventListener('click', () => {
                if (state.currentThemePage > 1) state.currentThemePage--;
                render();
            });

            document.getElementById('next-theme-page').addEventListener('click', () => {
                const totalPages = Math.ceil(getFilteredThemes().length / state.themesPerPage);
                if (state.currentThemePage < totalPages) state.currentThemePage++;
                render();
            });

            document.getElementById('theme-surah-select').addEventListener('change', () => {
                state.currentThemePage = 1;
                populateThemeSelect();
                render();
            });

            document.getElementById('theme-select').addEventListener('change', () => {
                state.currentThemePage = 1;
                render();
            });
        };

        const App = () => {
            return (
                <>
                    <header>
                        <h1 className="main-title">قرآن مجید</h1>
                        <div>
                            <button id="settings-toggle" className="page-button">
                                <i className="fas fa-cog"></i> ترتیبات
                            </button>
                        </div>
                    </header>
                    <SettingsPanel />
                    <ErrorPanel />
                    <SearchPanel />
                    <Tabs />
                    <QuranTab />
                    <ThemesTab />
                    <BookmarksTab />
                </>
            );
        };

        const SettingsPanel = () => {
            return (
                <div id="settings-panel" className={`settings-panel ${state.darkMode ? 'dark-mode' : ''}`}>
                    <h3>ترتیبات</h3>
                    <div className="font-size-controls">
                        <span>فونٹ سائز:</span>
                        <button id="decrease-font" className="font-btn">-</button>
                        <button id="increase-font" className="font-btn">+</button>
                    </div>
                    <div className="mode-toggle-container">
                        <span>موڈ:</span>
                        <div id="mode-toggle" className="mode-toggle">
                            <i className="fas fa-sun"></i>
                            <i className="fas fa-moon" style={{ display: 'none' }}></i>
                        </div>
                    </div>
                    <div style={{ marginTop: '15px' }}>
                        <span>زبان:</span>
                        <select id="language-toggle">
                            <option value="urdu" selected={state.language === 'urdu'}>اردو</option>
                            <option value="english" selected={state.language === 'english'}>English</option>
                            <option value="both" selected={state.language === 'both'}>دونوں</option>
                        </select>
                    </div>
                </div>
            );
        };

        const ErrorPanel = () => {
            return (
                <div id="error-message" className="error" style={{ display: 'none' }}></div>
            );
        };

        const SearchPanel = () => {
            return (
                <div className="search-container">
                    <div className="search-wrapper">
                        <input type="text" id="search-input" className="search-input" placeholder="قرآن میں تلاش کریں..." />
                        <i className="fas fa-search search-icon"></i>
                    </div>
                    <button id="search-button" className="search-button">تلاش کریں</button>
                </div>
            );
        };

        const Tabs = () => {
            return (
                <div className="tab-container">
                    <div className={`tab ${state.currentPage === 1 ? 'active' : ''}`} data-tab="quran">قرآن</div>
                    <div className={`tab ${state.currentPage === 2 ? 'active' : ''}`} data-tab="themes">میزاجات</div>
                    <div className={`tab ${state.currentPage === 3 ? 'active' : ''}`} data-tab="bookmarks">نشانیاں</div>
                </div>
            );
        };

        const QuranTab = () => {
            return (
                <div id="quran-tab" className={`tab-content ${state.currentPage === 1 ? 'active' : ''}`}>
                    <Controls />
                    <div id="quran-container"></div>
                    <div id="quran-loading" className="loading">
                        <div className="spinner"></div>
                    </div>
                </div>
            );
        };

        const ThemesTab = () => {
            return (
                <div id="themes-tab" className={`tab-content ${state.currentPage === 2 ? 'active' : ''}`}>
                    <Controls />
                    <div id="themes-container"></div>
                    <div id="themes-loading" className="loading">
                        <div className="spinner"></div>
                    </div>
                </div>
            );
        };

        const BookmarksTab = () => {
            return (
                <div id="bookmarks-tab" className={`tab-content ${state.currentPage === 3 ? 'active' : ''}`}>
                    <h2>آپ کی نشانیاں</h2>
                    <div id="bookmarks-container" className="bookmarks-list"></div>
                </div>
            );
        };

        const Controls = () => {
            return (
                <div className="controls">
                    <div>
                        <select id="chapter-select" className="chapter-select">
                            <option value="">سورۃ منتخب کریں</option>
                        </select>
                    </div>
                    <div className="goto-container">
                        <input type="text" id="goto-input" placeholder="سورۃ:آیت (مثال: 2:255)" />
                        <button id="goto-button" className="page-button">جائیں</button>
                    </div>
                    <div className="pagination">
                        <button id="prev-page" className="page-button">
                            <i className="fas fa-chevron-right"></i> پچھلا
                        </button>
                        <span id="page-info">صفحہ 1</span>
                        <button id="next-page" className="page-button">
                            اگلا <i className="fas fa-chevron-left"></i>
                        </button>
                    </div>
                </div>
            );
        };

        // Fetch Data and Initialize
        const init = async () => {
            await loadQuran();
            await loadThemes();
            setupEventListeners();
            render();
        };

        init();
    </script>
</body>
</html>
